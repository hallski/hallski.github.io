import{S as me,i as ce,s as ue,w as ae,f as he,m as fe,j as ye,k as pe,q as we,n as je,o as be,P as de,e as n,g as i,a as R,b as s,d as o}from"./vendor-e167c7c5.js";import{B as Se}from"./blog-layout-233a6880.js";function _e(u){let l,p,d,m,a,r,c,E,j,F,b,U,S,W,_,$,k,P,v,K,C,V,T,B,I,z,h,G,N,X,x,Z,M,J,f,Q,L,Y,q,ee,y,te,H,se,O,oe,w,ne,g,ie,D,le,A;return{c(){l=n("p"),l.textContent="Last week I decided to look into how to create a source list that is backed by Core Data with section headers created from code. New to Cocoa I set out to Google for a solution but surprisingly enough I didn\u2019t find a lot about how to achieve this (or I simply googled for the wrong things). After a few days I managed to derive, what I believe, an elegant solution to this and figured it could be useful for others wanting to do this.",p=i(),d=n("p"),d.innerHTML='<img src="/images/posts/sl-cd-result.png" alt="The planned source list"/>',m=i(),a=n("h2"),a.textContent="Approaches",r=i(),c=n("p"),c.textContent="My first plan was to create some kind of layer in between Core Data and the NSTreeController but that quickly added a lot of complexity and code. The second solution was to create the headers and put them in Core Data the first time you start the application. While this was easily done it felt a bit hackish.",E=i(),j=n("p"),j.innerHTML='After spending a couple of days with this, trying out various solutions and ideas me and <a href="http://twitter.com/rhult" rel="nofollow">Richard</a> discussed the topic, wondering if maybe Core Data had some builtin support for this.',F=i(),b=n("p"),b.textContent="Twenty minutes and some fifty lines of code later I looked at the screen, amazed at how awesome Core Data is. This is what I ended up with, mind though that it\u2019s not a full tutorial but only the crucial steps, you still need to know how to connect it all with the NSTreeController and NSOutlineView.",U=i(),S=n("h2"),S.textContent="The Solution",W=i(),_=n("p"),_.textContent="The idea is to use two different persistent stores, the regular XML store and an in memory store for the code generated entites.",$=i(),k=n("p"),k.innerHTML="For the purpose of this example the data model is very simple, two entities called <em>Section</em> (for the code generated section headers) and <em>Item</em> (for the entities that are read from Core Data).",P=i(),v=n("p"),v.innerHTML="<em>Section</em> will have a <code>name</code> attribute and a one-to-many relationship to <em>Item</em> called <code>children</code>. <em>Item</em> will have a <code>name</code> and a reverse to-one relationship back to <em>Section</em> called <code>section</code>. Make sure you <strong>make this relationship transient</strong> to tell Core Data that this relationship only exists runtime and should not be stored.",K=i(),C=n("p"),C.innerHTML='<img src="/images/posts/sl-cd-datamodel1.png" alt="The data model"/>',V=i(),T=n("p"),T.innerHTML="The <em>NSTreeController</em> has a property called <code>childrenKeyPath</code> that defines the key path to retrieve an array of children from each of the nodes in the tree. All nodes displayed in the tree need to respond to this key path. Since <em>Item</em>s don\u2019t have children it is not included in the data model (though you could have added it in the model designer but in my opinion isn\u2019t as nice), I will instead create a subclass of <em>NSManagedObject</em> to represent an <em>Item</em>.",B=i(),I=n("p"),I.innerHTML="Select the <em>Item</em> entity in the model designer and create a new file (File-&gt;New File and choose Managed Object Class from the Cocoa section). Simply name it Item.m (and check the <em>Also create \u201CItem.h\u201D</em>) box. Add a method <code>children</code> to your <em>Item</em> class.",z=i(),h=n("div"),h.innerHTML=`<div class="highlight"><pre class="highlight"><code><span class="hljs-comment">/* In Item.h */</span>
- (<span class="hljs-keyword">id</span>)children;

<span class="hljs-comment">/* In Item.m */</span>
- (<span class="hljs-keyword">id</span>)children
{
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
}</code></pre></div>`,G=i(),N=n("p"),N.innerHTML="This method will be called by the NSTreeController when it is populating the tree and since an <em>Item</em> doesn\u2019t have any children it should return <code>nil</code>.",X=i(),x=n("p"),x.textContent="That\u2019s it for the model, time to setup the stores.",Z=i(),M=n("p"),M.innerHTML="I extended the method <code>persistentStoreCoordinator</code> in the auto generated application delegate to create a second store with the URL <em>memory://store</em>. This store should be of the type <code>NSInMemoryStoreType</code> which means that any entity tied to it won\u2019t be saved to disk.",J=i(),f=n("div"),f.innerHTML=`<div class="highlight"><pre class="highlight"><code>url = [<span class="hljs-built_in">NSURL</span> URLWithString:<span class="hljs-string">@&quot;memory://store&quot;</span>];
<span class="hljs-keyword">if</span> (![persistentStoreCoordinator addPersistentStoreWithType:<span class="hljs-built_in">NSInMemoryStoreType</span>
                                              configuration:<span class="hljs-literal">nil</span>
                                                        URL:url
                                                    options:<span class="hljs-literal">nil</span>
                                                      error:&amp;error]) {
    [[<span class="hljs-built_in">NSApplication</span> sharedApplication] presentError:error];
}</code></pre></div>`,Q=i(),L=n("p"),L.textContent="Both of these stores act in the same context so the layers on top of Core Data won\u2019t know the difference between entites in one store or another.",Y=i(),q=n("p"),q.innerHTML="With the store in place the <em>Section</em> entities are created when the application is started, I added the code to the application delegate init method. After I create the <em>Section</em> I populate it with the result of fetching all my <em>Item</em> entities from Core Data (lines 30-33 below).",ee=i(),y=n("div"),y.innerHTML=`<div class="highlight"><pre class="highlight"><code>- (<span class="hljs-built_in">NSArray</span> *)fetchAllWithEntity:(<span class="hljs-built_in">NSString</span> *)entity
                          error:(<span class="hljs-built_in">NSError</span> **)error
{
    <span class="hljs-built_in">NSFetchRequest</span> *request;
    <span class="hljs-built_in">NSEntityDescription</span> *desc;

    desc = [<span class="hljs-built_in">NSEntityDescription</span> entityForName:entity
                       inManagedObjectContext:[<span class="hljs-keyword">self</span> managedObjectContext]];

    request = [[[<span class="hljs-built_in">NSFetchRequest</span> alloc] init] autorelease];
    [request setEntity:desc];

    <span class="hljs-keyword">return</span> [[<span class="hljs-keyword">self</span> managedObjectContext] executeFetchRequest:request error:error];
}

- (<span class="hljs-keyword">id</span>)init
{
    [<span class="hljs-keyword">super</span> init];

    <span class="hljs-built_in">NSError</span> *error;
    <span class="hljs-built_in">NSURL</span> *url = [<span class="hljs-built_in">NSURL</span> URLWithString:<span class="hljs-string">@&quot;memory://store&quot;</span>];
    <span class="hljs-keyword">id</span> memoryStore = [[<span class="hljs-keyword">self</span> persistentStoreCoordinator] persistentStoreForURL:url];

    section = [[<span class="hljs-built_in">NSEntityDescription</span> insertNewObjectForEntityForName:<span class="hljs-string">@&quot;Section&quot;</span>
                                             inManagedObjectContext:[<span class="hljs-keyword">self</span> managedObjectContext]] <span class="hljs-keyword">retain</span>];
    [section setValue:<span class="hljs-string">@&quot;My section&quot;</span> forKey:<span class="hljs-string">@&quot;name&quot;</span>];
    [[<span class="hljs-keyword">self</span> managedObjectContext] assignObject:section
                            toPersistentStore:memoryStore];

    <span class="hljs-built_in">NSArray</span> *items = [<span class="hljs-keyword">self</span> fetchAllWithEntity:<span class="hljs-string">@&quot;Item&quot;</span> error:&amp;error];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">id</span> item <span class="hljs-keyword">in</span> items) {
        [item setValue:section forKey:<span class="hljs-string">@&quot;section&quot;</span>];
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}</code></pre></div>`,te=i(),H=n("p"),H.innerHTML="Here the message <code>assignObject:toPersistentStore:</code> is sent to the <code>NSManagedObjectContext</code> to put the newly created <em>Section</em> in the in memory store so that it is not saved to disk with the <em>Item</em>s.",se=i(),O=n("p"),O.innerHTML="I also added an action to my application delegate to create new <em>Item</em>s and make them children to the <em>Section</em>.",oe=i(),w=n("div"),w.innerHTML=`<div class="highlight"><pre class="highlight"><code>- (<span class="hljs-keyword">void</span>)addItem:(<span class="hljs-keyword">id</span>)sender
{
    <span class="hljs-keyword">id</span> newObject = [<span class="hljs-built_in">NSEntityDescription</span> insertNewObjectForEntityForName:<span class="hljs-string">@&quot;Item&quot;</span>
                                                 inManagedObjectContext:[<span class="hljs-keyword">self</span> managedObjectContext]];
    [newObject setValue:section forKey:<span class="hljs-string">@&quot;section&quot;</span>];
}</code></pre></div>`,ne=i(),g=n("p"),g.innerHTML="That\u2019s it! Now a regular <code>NSTreeController</code> can be used in entity mode by setting the entity to <em>Section</em> as you would normally do.",ie=i(),D=n("p"),D.innerHTML='I hope you found it useful, if you did, make sure you share it with your friends and subscribe to my <a href="http://hallski.org/atom.xml" rel="nofollow">RSS feed</a> or <a href="http://twitter.com/mhallendal" rel="nofollow">follow me on twitter</a> for notifications about future posts.',le=i(),A=n("p"),A.textContent="I\u2019d love to get feedback on better solutions, improvements or just comments on what you think.",R(h,"class","highlighter-rouge language-objc"),R(f,"class","highlighter-rouge language-objc"),R(y,"class","highlighter-rouge language-objc"),R(w,"class","highlighter-rouge language-objc")},m(e,t){s(e,l,t),s(e,p,t),s(e,d,t),s(e,m,t),s(e,a,t),s(e,r,t),s(e,c,t),s(e,E,t),s(e,j,t),s(e,F,t),s(e,b,t),s(e,U,t),s(e,S,t),s(e,W,t),s(e,_,t),s(e,$,t),s(e,k,t),s(e,P,t),s(e,v,t),s(e,K,t),s(e,C,t),s(e,V,t),s(e,T,t),s(e,B,t),s(e,I,t),s(e,z,t),s(e,h,t),s(e,G,t),s(e,N,t),s(e,X,t),s(e,x,t),s(e,Z,t),s(e,M,t),s(e,J,t),s(e,f,t),s(e,Q,t),s(e,L,t),s(e,Y,t),s(e,q,t),s(e,ee,t),s(e,y,t),s(e,te,t),s(e,H,t),s(e,se,t),s(e,O,t),s(e,oe,t),s(e,w,t),s(e,ne,t),s(e,g,t),s(e,ie,t),s(e,D,t),s(e,le,t),s(e,A,t)},d(e){e&&o(l),e&&o(p),e&&o(d),e&&o(m),e&&o(a),e&&o(r),e&&o(c),e&&o(E),e&&o(j),e&&o(F),e&&o(b),e&&o(U),e&&o(S),e&&o(W),e&&o(_),e&&o($),e&&o(k),e&&o(P),e&&o(v),e&&o(K),e&&o(C),e&&o(V),e&&o(T),e&&o(B),e&&o(I),e&&o(z),e&&o(h),e&&o(G),e&&o(N),e&&o(X),e&&o(x),e&&o(Z),e&&o(M),e&&o(J),e&&o(f),e&&o(Q),e&&o(L),e&&o(Y),e&&o(q),e&&o(ee),e&&o(y),e&&o(te),e&&o(H),e&&o(se),e&&o(O),e&&o(oe),e&&o(w),e&&o(ne),e&&o(g),e&&o(ie),e&&o(D),e&&o(le),e&&o(A)}}}function ke(u){let l,p;const d=[u[0],re];let m={$$slots:{default:[_e]},$$scope:{ctx:u}};for(let a=0;a<d.length;a+=1)m=ae(m,d[a]);return l=new Se({props:m}),{c(){he(l.$$.fragment)},m(a,r){fe(l,a,r),p=!0},p(a,[r]){const c=r&1?ye(d,[r&1&&pe(a[0]),r&0&&pe(re)]):{};r&2&&(c.$$scope={dirty:r,ctx:a}),l.$set(c)},i(a){p||(we(l.$$.fragment,a),p=!0)},o(a){je(l.$$.fragment,a),p=!1},d(a){be(l,a)}}}const re={comments:!1,date:"2009-04-06T00:00:00Z",section:"blog",tags:["objective-c"],title:"Source List with Core Data"};function ve(u,l,p){return u.$$set=d=>{p(0,l=ae(ae({},l),de(d)))},l=de(l),[l]}class Ce extends me{constructor(l){super();ce(this,l,ve,ke,ue,{})}}var Ne=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Ce,metadata:re});export{Ce as S,Ne as _,re as m};
