<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="content-security-policy" content="">
		<link href="../_app/immutable/assets/_layout-49e432a2.css" rel="stylesheet"><title>Hallski: Macruby Support in any Cocoa Application</title><!-- HEAD_svelte-1q3t53y_START --><link rel="alternate" type="application/atom+xml" href="https://hallski.org/atom.xml"><link rel="alternate" type="application/rss+xml" href="https://hallski.org/feed/rss"><link rel="alternate" type="application/json" href="https://hallski.org/feed/json"><link rel="stylesheet" href="/css/style.css" type="text/css"><!-- HEAD_svelte-1q3t53y_END --><!-- HEAD_svelte-4z5wxp_START --><!-- HEAD_svelte-4z5wxp_END -->
	</head>
	<body>
		<div id="svelte">




<header><nav class="navbar svelte-d1vz7p"><a class="nav-link svelte-d1vz7p" href="/">Home</a>
		<ul class="svelte-d1vz7p">
			<li class="svelte-d1vz7p"><a href="/blog" class="nav-link svelte-d1vz7p">Articles</a></li>
			
			<li class="svelte-d1vz7p"><a href="/about" class="nav-link svelte-d1vz7p">About</a></li></ul></nav>
</header>

<main class="main"><div class="content">

<article class="post"><header><h1>Macruby Support in any Cocoa Application</h1>
		<span class="post-date">May 06, 2009</span></header>
	<p>Yesterday I published a post about <a href="/blog/cocoa-prototyping-with-webview">Cocoa Prototyping with Webview</a> and today I found out about <a href="http://www.macruby.org/" rel="nofollow">Macruby</a> thanks to <a href="http://twitter.com/sarnesjo" rel="nofollow">@sarnesjo</a>. Already looking for ways of prototyping in Cocoa it’s hard to not find Macruby very interesting.</p>
<p>Macruby turns out to be a very powerful tool for prototyping (as well as writing entire applications in) as it fits perfectly fine in a normal Objective-C code base. What I wanted was something like this:</p>
<div class="highlighter-rouge language-ruby"><div class="highlight"><pre class="highlight"><code><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleController</span>
    <span class="hljs-built_in">attr_accessor</span> <span class="hljs-symbol">:label</span>
    <span class="hljs-built_in">attr_accessor</span> <span class="hljs-symbol">:button</span>
    <span class="hljs-built_in">attr_accessor</span> <span class="hljs-symbol">:my_view</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">buttonPressed</span>(<span class="hljs-params">sender</span>)
        label.setStringValue(<span class="hljs-string">&quot;I am (im)pressed!&quot;</span>)
        my_view.backgroundColor = <span class="hljs-title class_">NSColor</span>.redColor
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre></div></div>
<p>Where the view <code>:my_view</code> is implemented in Objective-C.</p>
<p>Here are the simple steps I used to hook it into a normal Xcode Cocoa project.</p>
<p>First of all, install Macruby which is as easy as downloading the zip-file from the website and run the installer.</p>
<p>In order to link to the Macruby framework you need to use garbage collection in your project, if you aren’t already you enable it in the project inspector:</p>
<p><img src="/images/posts/macruby-in-xcode-gc.png" alt="Set the project to use Garbage Collection"></p>
<p>Next you need to make your project link against the Macruby framework:</p>
<p><img src="/images/posts/macruby-in-xcode-add-framework.png" alt="Add the Macruby framework"></p>
<p>That’s it for the project settings, let’s hook it up in the code. When you use the built-in project template for a Macruby project a small Ruby file called <em>rb_main.rb</em> is created for you. Since I’m using a generic Cocoa application template I needed to create this file and simply copied the file into my new project (its code below). It loads all Ruby files in your bundle and starts the Cocoa main loop.</p>
<div class="highlighter-rouge language-ruby"><div class="highlight"><pre class="highlight"><code><span class="hljs-comment"># Loading the Cocoa framework. If you need to load more frameworks, you can</span>
<span class="hljs-comment"># do that here too.</span>
framework <span class="hljs-string">&#39;Cocoa&#39;</span>

<span class="hljs-comment"># Loading all the Ruby project files.</span>
dir_path = <span class="hljs-title class_">NSBundle</span>.mainBundle.resourcePath.fileSystemRepresentation
<span class="hljs-title class_">Dir</span>.entries(dir_path).each <span class="hljs-keyword">do</span> |<span class="hljs-params">path</span>|
  <span class="hljs-keyword">if</span> path != <span class="hljs-title class_">File</span>.basename(<span class="hljs-variable constant_">__FILE__</span>) <span class="hljs-keyword">and</span> path[-<span class="hljs-number">3</span>..-<span class="hljs-number">1</span>] == <span class="hljs-string">&#39;.rb&#39;</span>
    <span class="hljs-keyword">require</span>(path)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment"># Starting the Cocoa main loop.</span>
<span class="hljs-title class_">NSApplicationMain</span>(<span class="hljs-number">0</span>, <span class="hljs-literal">nil</span>)</code></pre></div></div>
<p>To start the actual Ruby interpreter the file <em>main.m</em> needs to be modified. Since the Ruby code now starts the Cocoa main loop we no longer need to do that in <code>main</code>. <em>Main.m</em> simply becomes:</p>
<div class="highlighter-rouge language-c"><div class="highlight"><pre class="highlight"><code><span class="hljs-meta">#import <span class="hljs-string">&lt;MacRuby/MacRuby.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span>
{
    <span class="hljs-keyword">return</span> macruby_main(<span class="hljs-string">&quot;rb_main.rb&quot;</span>, argc, argv);
}</code></pre></div></div>
<p>With these changes you can now start writing code in either Ruby or Objective-C within the same project. Here are the files I ended up with in my very small example.</p>
<p><img src="/images/posts/macruby-in-xcode-files.png" alt="Example Files"></p>
<p>The final application simply shows a small window with a button:</p>
<p><img src="/images/posts/macruby-in-xcode-example.png" alt="Example window"></p>
<p>Make sure to watch the great <a href="http://pragmaticstudio.com/screencasts/6-macruby" rel="nofollow">introductionary screencast</a> then download the example project and get started tinkering.</p>
<p>If you find this as cool and useful as I did, let me hear about it!</p>
<p><strong>Edit:</strong> Be sure to read Laurents comment below for an alternative way of loading your Ruby files into your application.</p></article></div></main>

<footer class="site-footer svelte-1h9y0mo"><div class="author svelte-1h9y0mo"><img class="author-photo svelte-1h9y0mo" src="/images/hallski.jpg" width="192" height="192" alt="Author">
		<div><p class="author-name svelte-1h9y0mo">Mikael Hallendal</p>
			<p class="author-info svelte-1h9y0mo">Developer who loves to learn new things.</p>
			<p class="author-interests svelte-1h9y0mo">Current focus: <span class="interest svelte-1h9y0mo">React</span>,
				<span class="interest svelte-1h9y0mo">Javascript/Typescript</span> and
				<span class="interest svelte-1h9y0mo">Elixir</span></p>
			<nav class="find-me svelte-1h9y0mo"><a href="http://github.com/hallski/" class="svelte-1h9y0mo">Github</a>
				<a href="http://www.linkedin.com/in/mhallendal" class="svelte-1h9y0mo">LinkedIn</a></nav></div></div>
</footer>

</div>
	</body>
</html>
